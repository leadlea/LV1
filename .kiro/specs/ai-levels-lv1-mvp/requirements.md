# 要件定義書

## はじめに

AI Levels Lv1 MVPは、AIカリキュラム「分業設計×依頼設計×品質担保×2ケース再現」をブラウザからログインなしで実行できるシステムである。3つのAIエージェント（出題・採点・レビュー）が連動し、テスト自動生成・合否判定・フィードバック生成をパイプラインとして実行する。将来Lv2〜Lv4への拡張を前提としたゲーティング構造を初期から備える。

## 用語集

- **フロントエンド**: S3に配置されCloudFrontで配信される静的Webサイト
- **バックエンドAPI**: API Gateway（REST）+ Lambda（Python 3.12）で構成されるサーバーレスAPI
- **出題エージェント（Test_Generator）**: カリキュラムに基づきテスト・ドリルをランダム生成するAIエージェント
- **採点エージェント（Grader）**: ユーザー回答を受け取り合否判定を行うAIエージェント
- **レビューエージェント（Reviewer）**: 採点結果をもとにフィードバック・解説を生成するAIエージェント
- **Bedrock_Runtime**: AWS Bedrock上のClaude Opus 4.6モデル（global.anthropic.claude-opus-4-6-v1）を呼び出すランタイム
- **セッション**: ブラウザ上で1回のLv1実行を開始してから完了するまでの一連の操作
- **ゲーティング**: 前レベル合格がないと次レベルを表示しない制御構造
- **カリキュラム**: Lv1で扱う学習内容（分業設計×依頼設計×品質担保×2ケース再現）
- **完了レコード**: 全ステップ完了時にDynamoDBに保存される設問・回答・採点結果の一式

## 要件

### 要件1: テスト・ドリルのランダム生成

**ユーザーストーリー:** カリキュラム受講者として、実行するたびに異なるテスト・ドリル内容を受け取りたい。同じ内容の暗記ではなく、毎回新しい問題で理解度を確認できるようにするため。

#### 受入基準

1. WHEN ユーザーがLv1セッションを開始する, THE Test_Generator SHALL カリキュラム「分業設計×依頼設計×品質担保×2ケース再現」に基づいたテスト・ドリルを生成する
2. WHEN 同一ユーザーがLv1セッションを再実行する, THE Test_Generator SHALL 前回とは異なる内容のテスト・ドリルを生成する
3. WHEN Test_Generatorがテスト・ドリルを生成する, THE バックエンドAPI SHALL Bedrock_Runtimeを通じてClaude Opus 4.6モデルを呼び出す
4. WHEN テスト・ドリルが生成される, THE Test_Generator SHALL ステップバイステップで進行可能な形式で設問を構成する

### 要件2: ユーザー回答の採点

**ユーザーストーリー:** カリキュラム受講者として、自分の回答に対して合否判定を受けたい。理解度を客観的に確認できるようにするため。

#### 受入基準

1. WHEN ユーザーが設問に回答を送信する, THE Grader SHALL 回答内容を受け取り合否判定を実行する
2. WHEN Graderが採点を実行する, THE バックエンドAPI SHALL Bedrock_Runtimeを通じてClaude Opus 4.6モデルを呼び出す
3. WHEN Graderが採点を完了する, THE Grader SHALL 合格または不合格の判定結果を返却する

### 要件3: フィードバック・解説の生成

**ユーザーストーリー:** カリキュラム受講者として、採点結果に基づいたフィードバックと解説を受け取りたい。理解が不足している箇所を把握し学習を深められるようにするため。

#### 受入基準

1. WHEN Graderが採点結果を返却する, THE Reviewer SHALL 採点結果をもとにフィードバックと解説を生成する
2. WHEN Reviewerがフィードバックを生成する, THE バックエンドAPI SHALL Bedrock_Runtimeを通じてClaude Opus 4.6モデルを呼び出す
3. WHEN Reviewerがフィードバックを生成完了する, THE フロントエンド SHALL フィードバックと解説をユーザーに表示する

### 要件4: 3エージェント連動パイプライン

**ユーザーストーリー:** カリキュラム受講者として、出題→回答→採点→レビューの一連の流れをシームレスに体験したい。途切れることなく学習を進められるようにするため。

#### 受入基準

1. THE バックエンドAPI SHALL Test_Generator、Grader、Reviewerの3エージェントを順序通りに連動させるパイプラインを提供する
2. WHEN Test_Generatorがテスト・ドリルを生成完了する, THE フロントエンド SHALL 設問をユーザーに表示し回答入力を受け付ける
3. WHEN ユーザーが回答を送信する, THE バックエンドAPI SHALL Graderに回答を渡して採点を実行する
4. WHEN Graderが採点を完了する, THE バックエンドAPI SHALL Reviewerに採点結果を渡してフィードバック生成を実行する
5. WHEN 全ステップが完了する, THE フロントエンド SHALL 最終結果（合否・フィードバック）をユーザーに表示する

### 要件5: 完了時のみのデータ永続化

**ユーザーストーリー:** システム運営者として、全ステップを完了したセッションのデータのみをDynamoDBに保存したい。途中離脱データによるストレージコスト増加を防ぐため。

#### 受入基準

1. WHEN ユーザーが全ステップを完了する, THE バックエンドAPI SHALL 設問・回答・採点結果の完了レコードをDynamoDBに保存する
2. WHILE ユーザーがセッション途中である, THE バックエンドAPI SHALL DynamoDBへの書き込みを行わない
3. WHEN 完了レコードをDynamoDBに保存する, THE バックエンドAPI SHALL セッション識別子、タイムスタンプ、全設問、全回答、全採点結果、最終合否を含める
4. IF DynamoDBへの保存が失敗する, THEN THE バックエンドAPI SHALL エラーをログに記録しユーザーにリトライ可能な旨を通知する

### 要件6: ゲーティング構造

**ユーザーストーリー:** カリキュラム受講者として、Lv1に合格してからLv2に進みたい。段階的に学習を積み上げられるようにするため。

#### 受入基準

1. THE フロントエンド SHALL Lv1のみを初期表示し、Lv2以降は非表示とする
2. WHEN ユーザーがLv1に合格する, THE フロントエンド SHALL Lv2を表示可能にする
3. WHILE ユーザーがLv1に合格していない, THE フロントエンド SHALL Lv2以降のレベルを表示しない
4. THE バックエンドAPI SHALL レベル合格状態を検証するエンドポイントを提供する
5. WHEN フロントエンドがレベル表示を判定する, THE フロントエンド SHALL バックエンドAPIのレベル合格状態検証エンドポイントを呼び出して判定する

### 要件7: ログインなしでのアクセス

**ユーザーストーリー:** カリキュラム受講者として、アカウント登録やログインなしでLv1を実行したい。手軽に学習を開始できるようにするため。

#### 受入基準

1. THE フロントエンド SHALL 認証なしでLv1カリキュラムページにアクセス可能とする
2. WHEN ユーザーがサイトにアクセスする, THE フロントエンド SHALL ログイン画面を表示せずにLv1開始画面を表示する
3. THE バックエンドAPI SHALL 認証トークンなしでLv1関連エンドポイントへのリクエストを受け付ける

### 要件8: フロントエンド静的サイト配信

**ユーザーストーリー:** カリキュラム受講者として、ブラウザからスムーズにカリキュラムにアクセスしたい。快適な学習体験を得られるようにするため。

#### 受入基準

1. THE フロントエンド SHALL S3バケット（ai-levels）に静的サイトとして配置される
2. THE フロントエンド SHALL CloudFront（E1SGV7O9QH5NRD）を通じて配信される
3. WHEN ユーザーがブラウザでアクセスする, THE フロントエンド SHALL ステップバイステップのカリキュラムUIを表示する
4. THE フロントエンド SHALL レスポンシブデザインでモバイル・デスクトップ両方に対応する

### 要件9: バックエンドサーバーレスAPI

**ユーザーストーリー:** システム運営者として、サーバーレス構成でバックエンドを運用したい。運用コストを最小化しスケーラビリティを確保するため。

#### 受入基準

1. THE バックエンドAPI SHALL API Gateway（REST）とLambda（Python 3.12）で構成される
2. THE バックエンドAPI SHALL Serverless Frameworkを使用してデプロイされる
3. WHEN Lambda関数がBedrock_Runtimeを呼び出す, THE Lambda関数 SHALL ap-northeast-1リージョンのBedrock_Runtimeエンドポイントを使用する
4. WHEN Lambda関数がBedrock_Runtimeを呼び出す, THE Lambda関数 SHALL モデルID「global.anthropic.claude-opus-4-6-v1」を指定する

### 要件10: CI/CDパイプライン

**ユーザーストーリー:** 開発者として、コードをpushするだけで自動デプロイされるようにしたい。開発サイクルを高速化するため。

#### 受入基準

1. WHEN コードがmainブランチにpushされる, THE CI/CDパイプライン SHALL GitHub Actionsを通じてServerless Frameworkでバックエンドをデプロイする
2. WHEN コードがmainブランチにpushされる, THE CI/CDパイプライン SHALL フロントエンドをS3バケット（ai-levels）に同期する
3. WHEN S3同期が完了する, THE CI/CDパイプライン SHALL CloudFront（E1SGV7O9QH5NRD）のキャッシュを無効化する
4. THE CI/CDパイプライン SHALL SERVERLESS_ACCESS_KEYを使用してServerless Frameworkの認証を行う
